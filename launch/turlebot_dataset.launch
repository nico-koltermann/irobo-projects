<?xml version="1.0"?>
<launch>

  <!-- Config -->
  <arg name="map_file" default="map.yaml"/>
  <arg name="bag_file" default="slam_easy.bag"/>
  <arg name="node_start_delay" default="5.0"/>
  <arg name="enable_rviz" default="true"/>

  <!-- Correct the sim time -->
  <param name="use_sim_time" value="true"/>

  <!-- Launch rviz visualization-->
  <group if="$(arg enable_rviz)">
    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find turtlebot3_datasets)/rviz/dataset.rviz" />
  </group>

  <node name="publish_initial_tf" pkg="turtlebot3_datasets" type="publish_initial_tf.sh" args="map" output="screen"></node>

  <!-- Start robot and mapserver -->
  <include file="$(find turtlebot3_datasets)/launch/turtlebot3_description.launch"/>
  <node name="map_server" pkg="map_server" type="map_server" args="$(find turtlebot3_datasets)/data/$(arg map_file)" />
  <node pkg="tf2_ros" type="static_transform_publisher" name="odom_wrt_map_tf2" args="0 0 0 0 0 0 odom map" />
  <node pkg="tf2_ros" type="static_transform_publisher" name="odom_wrt_map_tf22" args="0 0 0 0 0 0 odom odometry/filtered" />


  <!-- ekf_localization_node -->
  <node pkg="robot_localization" type="ekf_localization_node" name="robot_localization_ekf_node_odom">
    <param name="frequency" value="5." />
    <param name="sensor_timeout" value="0.2" />
    <param name="two_d_mode" value="true" />
    <param name="publish_tf" value="false" />
    <param name="map_frame" value="map" />
    <param name="odom_frame" value="odom" />
    <param name="base_link_frame" value="base_link" />
    <param name="world_frame" value="map" />
    <param name="odom0" value="odom" />
    <rosparam param="odom0_config">
      [true, true, false,
       false, false, true,
       true, false, false,
       false, false, true,
       false, false, false]</rosparam>
    <param name="odom0_differential" value="false"/>
    <param name="imu0" value="imu" />
    <rosparam param="imu0_config">
      [false, false, false,
       false, false, false,
       false, false, false,
       false, false, false,
       false, false, false]</rosparam>
  </node> 

  <!-- Evaluation -->
  <node name="turtlebot3_viz" pkg="turtlebot3_viz" type="turtlebot3_viz.py" output="screen"></node>
  <!-- <node name="turtlebot3_viz_scan_match" pkg="turtlebot3_viz_scan_match" type="turtlebot3_viz_scan_match.py" output="screen"></node> -->

  <!-- RosBag -->
  <node pkg="rosbag" type="play" name="player" output="screen" args="--clock -q $(find turtlebot3_datasets)/data/$(arg bag_file)"></node>

</launch>